<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Business Owner Sign-Up</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=EPnN8sfzHMua72kW2vyRp2nLph-ManxYnzSkHflGbkFlhqkSef8KMNuOG-3WxLKxpWbWBwPFnGRLskxB&vault=true&intent=subscription"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .form-container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
    input { display: block; width: 100%; padding: 10px; margin-bottom: 10px; }
    button { padding: 10px 15px; background-color: #0070ba; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Business Owner Sign-Up</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <input type="text" id="ownerName" placeholder="Owner Name" />
    <input type="text" id="businessName" placeholder="Business Name" />
    <input type="text" id="address" placeholder="Address (optional)" />
    <input type="text" id="phone" placeholder="Phone Number" />
    <input type="text" id="logo" placeholder="Logo URL" />
    <input type="text" id="city" placeholder="City" />
    <input type="text" id="state" placeholder="State" />
    <input type="text" id="services" placeholder="List of Services (comma-separated)" />
    <input type="text" id="hours" placeholder="Hours of Operation (optional)" />
    <button onclick="register()">Register and Continue</button>
    <div id="paypal-button-container" style="margin-top: 20px;"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDHROoVHEPvBSo7ZXGZB2xf7Wnb_U9SErs",
      authDomain: "black-service-spot.firebaseapp.com",
      projectId: "black-service-spot",
      storageBucket: "black-service-spot.firebasestorage.app",
      messagingSenderId: "707361777966",
      appId: "1:707361777966:web:f41f3276b26d5dca50b2bf",
      measurementId: "G-HDD97PF8K7"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let newUID = null;

    function register() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const data = {
        ownerName: document.getElementById('ownerName').value,
        businessName: document.getElementById('businessName').value,
        address: document.getElementById('address').value,
        phone: document.getElementById('phone').value,
        logo: document.getElementById('logo').value,
        city: document.getElementById('city').value,
        state: document.getElementById('state').value,
        services: document.getElementById('services').value.split(',').map(x => x.trim()),
        email,
        hours: document.getElementById('hours').value
      };

      auth.createUserWithEmailAndPassword(email, password).then(userCred => {
        newUID = userCred.user.uid;
        return db.collection('Business_owners').doc(newUID).set(data);
      }).then(() => {
        launchPayPal(newUID);
      }).catch(error => {
        alert("Error: " + error.message);
      });
    }

    function launchPayPal(uid) {
      const params = new URLSearchParams(window.location.search);
      const plan = params.get("plan");

      let planId = "";
      if (plan === "monthly") {
        planId = "P-37739232P6875371KNB7M33A";
      } else if (plan === "annual") {
        planId = "P-6VE96793E07454030NB7M7IA";
      } else {
        alert("Missing or invalid plan parameter in URL.");
        return;
      }

      paypal.Buttons({
        createSubscription: function(data, actions) {
          return actions.subscription.create({ plan_id: planId });
        },
        onApprove: function(data, actions) {
          window.location.href = `dashboard.html?uid=${uid}`;
        }
      }).render('#paypal-button-container');
    }
  </script>
</body>
</html>
